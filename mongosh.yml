- name: mongoshell playbook
  hosts: ops1.smartek.ae
  become: true
  become_method: sudo
  
  tasks:
  - name: Check if Mongosh is installed
    ansible.builtin.command: mongosh --version
    register: mongosh_check
    ignore_errors: true

  - name: Include other playbook if Mongosh is not installed
    include_playbook: mongo_installation.yml
    when: mongosh_check.rc != 0


  - name: Initiate MongoDB replica set
    community.mongodb.mongodb_shell:
      eval: "rs.initiate()"
      login_host: ops1.smartek.ae:27017

  - name: add nodes
    community.mongodb.mongodb_shell:
      eval: "rs.add(' {{ item }} ')"
      login_host: ops1.smartek.ae:27017
    with_items:
      - ops2.smartek.ae:27017
      - ops3.smartek.ae:27017




